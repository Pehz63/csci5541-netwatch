<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Appropriateness Filtering for Corporate RAG Database Storage | CSCI 5541 (Fall 2025)</title>
  <link rel="stylesheet" href="./files/bulma.min.css" />
  <link rel="stylesheet" href="./files/styles.css" />
  <link rel="preconnect" href="https://fonts.gstatic.com/" />
  <link href="./files/css2" rel="stylesheet" />
  <link href="./files/css" rel="stylesheet" />
  <base href="." target="_blank" />
  <style>
    .wrapper{max-width:980px;margin:0 auto;padding:24px}
    .sys-img img{width:100%;height:auto}
    .authors-wrapper{display:flex;gap:18px;flex-wrap:wrap}
    .author-container{display:flex;flex-direction:column;align-items:center}
    .author-image img{width:96px;height:96px;border-radius:50%;object-fit:cover;background:#eee}
    .taglist{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 0}
    .kbd{background:#f5f5f5;border:1px solid #ddd;border-bottom-width:2px;border-radius:6px;padding:2px 6px;font-family:monospace}
    table{margin:0 auto}
    caption{caption-side:bottom;padding-top:8px}
    .note{font-size:.95rem;color:#444}
    .callout{background:#f7fbff;border:1px solid #cfe8ff;border-radius:10px;padding:12px}
  </style>
</head>
<body>
  <div class="wrapper">
    <h1 style="font-family:'Lato',sans-serif;">Appropriateness Filtering for Corporate RAG Database Storage</h1>
    <h4 style="font-family:'Lato',sans-serif;">Fall 2025 ¬∑ CSCI 5541 NLP ¬∑ University of Minnesota</h4>
    <h4 style="font-family:'Lato',sans-serif;">Team: NetWatch</h4>

    <p class="tagline">Reducing "rubbish in, rubbish out" for enterprise RAG by <em>pre-embedding filtering</em> of claim-level content from informal communications (email/Slack).</p>

    <div class="authors-wrapper">
      <div class="author-container">
        <div class="author-image"><img src="./files/Alex_B.png" alt="A. Berg" /></div>
        <p><strong>Alex Berg</strong><br/><small><a href="mailto:ber00221@umn.edu">ber00221@umn.edu</a></small></p>
      </div>
      <div class="author-container">
        <div class="author-image"><img src="./files/Zeph_J.jpg" alt="Z. Johnson" /></div>
        <p><strong>Zephaniah Johnson</strong><br/><small><a href="mailto:joh15514@umn.edu">joh15514@umn.edu</a></small></p>
      </div>
      <div class="author-container">
        <div class="author-image"><img src="./files/Alex_S.jpg" alt="A. Slinger" /></div>
        <p><strong>Alex Slinger</strong><br/><small><a href="mailto:sling031@umn.edu">sling031@umn.edu</a></small></p>
      </div>
      <div class="author-container">
        <div class="author-image"><img src="./files/Sunder_S.png" alt="S. Subramanian" /></div>
        <p><strong>Sunder Subramanian</strong><br/><small><a href="mailto:subra287@umn.edu">subra287@umn.edu</a></small></p>
      </div>
    </div>

    <br />

    <div class="authors-wrapper">
      <div class="publication-links">
        <span class="link-block">
          <a href="" class="external-link button is-normal is-rounded is-dark is-outlined"><span>Final Report</span></a>
        </span>
        <span class="link-block">
          <a href="" class="external-link button is-normal is-rounded is-dark is-outlined"><span>Code</span></a>
        </span>
        <span class="link-block">
          <a href="" class="external-link button is-normal is-rounded is-dark is-outlined"><span>Model Weights</span></a>
        </span>
      </div>
    </div>
  </div>

  <div class="wrapper">
    <hr />

    <h2 id="abstract">Abstract</h2>
    <p>
      Retrieval‚ÄëAugmented Generation (RAG) quality depends on what gets embedded. Informal business channels (email/Slack) often mix valuable facts with personal, toxic, speculative, or sarcastic content. We propose a <b>pre‚Äëembedding filtering</b> framework that decomposes messages into claim‚Äëlevel units and scores each with a modular MoE of fine‚Äëtuned RoBERTa‚Äëlarge classifiers (relevance, tone/sarcasm, confidentiality/PII, toxicity, speculation/opinion, inconsistency). Below‚Äëthreshold claims are dropped; retained claims keep scores for downstream weighting. We will compare <i>pre‚Äëfiltered RAG</i> against <i>vanilla RAG</i> and <i>LLM‚Äëprompted filtering</i>, studying compounding effects of layered filters on QA quality and safety within an enterprise domain.
    </p>
    <hr />

    <h2 id="introduction">Introduction / Background / Motivation</h2>
    <p><b>Problem.</b> Enterprises rely on RAG over large internal corpora, but ~unstructured email/chat blends professional and personal content. Embedding inappropriate or unreliable text degrades retrieval and raises compliance risk.</p>
    <p><b>Gap.</b> Prior work emphasizes post‚Äëretrieval tricks (graph fusion, RRF); little evaluates <i>source‚Äëlevel</i> filtering before embedding when full context (headers/threads) is available.</p>
    <p><b>Hypothesis.</b> Appropriateness filtering at ingestion improves QA relevance and reduces PII/leak risk versus post‚Äëhoc ranking alone. Ambiguous claims (e.g., sarcasm intertwined with facts) are retained with metadata rather than blindly dropped.</p>
    <hr />

    <h2 id="approach">Approach</h2>
    <div class="callout">
      <ol>
        <li><b>Ingestion.</b> Gmail (IMAP via <code>imaplib</code>) demo + ENRON emails (from XLSX in Google Drive). Parse message text, headers, thread context.</li>
        <li><b>Claim decomposition.</b> <i>Claimify</i> module (see below) splits messages into atomic claims; ambiguous spans preserved with context.</li>
        <li><b>MoE filtering.</b> Current prototype uses an LLM pipeline: <b>‚ÄúClaim 7‚Äëstep CoT + 2‚Äëstep ReAct classifier.ipynb‚Äù</b> implementing per‚Äëclaim decision heads (Relevance, PII/Confidentiality, Tone/Sarcasm, Toxicity, Speculation/Opinion, Inconsistency). Finetuned RoBERTa‚Äëlarge heads are planned; LLM classifiers are the present default.</li>
        <li><b>Storage & retrieval.</b> <code>Pinecone</code> index <code>netwatch-claims</code>, embeddings via OpenAI <code>text-embedding-3-large</code> (<code>3072</code> dims). Retrieve via ANN; semantic RRF ranking under construction.</li>
        <li><b>QA agent.</b> LangChain + LangGraph tool (<code>lookup_in_rag</code>) wired to OpenAI <code>gpt-5-mini</code>. DSPy configured for prompt experiments.</li>
      </ol>
    </div>
    <p><b>Baselines.</b> (A) Vanilla RAG (no pre‚Äëfilter). (B) RAG + LLM re‚Äërank/filters (zero‚Äë/few‚Äëshot). (C) Optional: post‚Äëfilter RRF only.</p>
    <p><b>Novelty.</b> We evaluate ingestion‚Äëtime, claim‚Äëlevel filtering in an informal‚Äëcommunications domain where appropriate and non‚Äëappropriate content co‚Äëexist within messages, and run end‚Äëto‚Äëend ablations to quantify compounding effects.</p>

    <h3 id="impl">Implementation Snapshot (from current Colab)</h3>
    <ul>
      <li><b>APIs/Keys:</b> OpenAI + Pinecone pulled from Colab <code>userdata</code>; Google Drive mounted to <code>/content/drive</code>.</li>
      <li><b>Embeddings:</b> <code>EMBED_MODEL = "text-embedding-3-large"</code> with <code>EMBED_DIMS = 3072</code>.</li>
      <li><b>Index:</b> <code>index_name = "netwatch-claims"</code> (AWS us‚Äëeast‚Äë1, cosine) created via <code>ServerlessSpec</code>.</li>
      <li><b>LLMs:</b> LangChain <code>init_chat_model("gpt-5-mini")</code>; DSPy LM <code>openai/gpt-5-mini</code> (confirmation print ok). Gemini helper code is gated/inactive.</li>
      <li><b>Data I/O:</b> XLSX workbook <code>claim_examples.xlsx</code> ‚Üí DataFrames: <code>example_claims_df</code>, <code>examples_msg_df</code>, <code>enron_claims_df</code>, <code>enron_msgs_df</code>, <code>gmail_claims_df</code>, <code>gmail_msgs_df</code> with <code>msg_id</code> coerced to <code>Int64</code>.</li>
      <li><b>Email ingest:</b> IMAP to <code>netwatch5541@gmail.com</code>; appends rows to <code>gmail_msgs_df</code>.</li>
      <li><b>Build DB:</b> <code>build_db()</code> indexes a test claim; pre‚Äëfilter hooks TODO (sarcasm/privacy/etc.).</li>
      <li><b>Retrieval:</b> <code>db_lookup()</code> and tool <code>lookup_in_rag</code> (semantic RRF placeholder).</li>
      <li><b>Agent/UI:</b> LangGraph state graph with tool calling; Gradio <code>ChatInterface</code> titled ‚ÄúNetwatch Final Project‚Äù.</li>
    </ul>
    <div class="callout"><b>Engineering notes:</b>
      <ul>
        <li>Unify any legacy 768‚Äëdim code paths to 3072 to match <code>text-embedding-3-large</code>.</li>
        <li>Fix minor bug in <code>lookup_in_rag</code>: inside the neighbor loop, replace <code>scores[nb["id"]]</code> with <code>scores[neighbor["id"]]</code>.</li>
        <li>Consider removing or guarding the Gemini scratch block to avoid accidental execution.</li>
      </ul>
    </div>
    <hr />

    <h2 id="claimify">Sunder‚Äôs Claimify Module</h2>
    <p><b>Owner:</b> S. Subramanian. <b>Notebook:</b> <i>Claim 7‚Äëstep CoT + 2‚Äëstep ReAct classifier.ipynb</i> (to be merged into main).</p>
    <ul>
      <li><b>Goal:</b> Robust claim segmentation + per‚Äëclaim gating before embedding.</li>
      <li><b>Flow:</b> (1) sentence spans ‚Üí (2) minimal‚Äëclaim refinement (CoT) ‚Üí (3) entity/PII redaction candidates ‚Üí (4) ReAct verification for uncertain cases.</li>
      <li><b>Outputs:</b> list of claims with labels + rationales + confidence; metadata carried into retrieval for re‚Äëweighting.</li>
      <li><b>Status:</b> running as LLM pipeline; finetuned heads planned for Relevance/PII/Tone first.</li>
    </ul>

    <hr />
    <h2 id="data">Data</h2>
    <p><b>Primary.</b> ~1,700 ENRON emails with tone/topic labels (email‚Äëlevel). For claim‚Äëlevel training/eval we construct a synthetic composite set by inserting professional facts/QA pairs (from MeetingBank‚ÄëQA‚ÄëSummary) into non‚Äëprofessional ENRON emails, yielding mixed‚Äëcontext messages with groundable QA.</p>
    <p><b>Claim extraction eval.</b> Benchmark against Claimify‚Äëstyle datasets to ensure accurate splitting independent of LLM prompting.</p>
    <hr />

    <h2 id="results">Preliminary Results & Evaluation</h2>
    <div class="callout"><b>Live Demo (local auth)</b>: Gradio chat is protected with <code>teamNetwatch</code> / <code>5541FinalProject</code>. Share link available during mentor meeting.</div>
    <p><b>Two tracks.</b> (1) <i>Classifier gating quality</i> on claims. (2) <i>Retrieval/QA utility</i> after pre‚Äëfiltering. We drop ROUGE‚ÄëL (not appropriate for this task) and use metrics aligned to accept/reject behavior and retrieval ranking quality.</p>

    <h3>Classifier Metrics (per‚Äëhead, claim level)</h3>
    <table class="table is-fullwidth is-striped">
      <thead>
        <tr>
          <th style="text-align:center">Classifier (current)</th>
          <th style="text-align:center">Source</th>
          <th style="text-align:center">Accept Acc‚Üë</th>
          <th style="text-align:center">Reject Acc‚Üë</th>
          <th style="text-align:center">Balanced Acc‚Üë</th>
          <th style="text-align:center">Precision<sub>accept</sub>‚Üë</th>
          <th style="text-align:center">Precision<sub>reject</sub>‚Üë</th>
          <th style="text-align:center">AUPRC / ROC‚ÄëAUC‚Üë</th>
          <th style="text-align:center">Notes</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="text-align:center"><b>Relevance</b></td>
          <td style="text-align:center">LLM CoT+ReAct</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">Finetune planned (RoBERTa‚Äëlarge)</td>
        </tr>
        <tr>
          <td style="text-align:center"><b>PII / Confidentiality</b></td>
          <td style="text-align:center">LLM CoT+ReAct</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">Redaction candidates emitted</td>
        </tr>
        <tr>
          <td style="text-align:center"><b>Tone / Sarcasm</b></td>
          <td style="text-align:center">LLM CoT+ReAct</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">Down‚Äërank if ambiguous</td>
        </tr>
        <tr>
          <td style="text-align:center"><b>Toxicity</b></td>
          <td style="text-align:center">LLM CoT+ReAct</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">Gate hard above threshold</td>
        </tr>
        <tr>
          <td style="text-align:center"><b>Speculation / Opinion</b></td>
          <td style="text-align:center">LLM CoT+ReAct</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">Store w/ flag vs. drop</td>
        </tr>
        <tr>
          <td style="text-align:center"><b>Inconsistency</b></td>
          <td style="text-align:center">LLM CoT+ReAct</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">Cross‚Äëclaim check (planned)</td>
        </tr>
      </tbody>
      <caption>Table A. Per‚Äëclassifier gating metrics focused on <i>accept/reject</i> behavior.</caption>
    </table>

    <h3>Retrieval/QA Metrics (system level)</h3>
    <table class="table is-fullwidth is-striped">
      <thead>
        <tr>
          <th style="text-align:center">Setting</th>
          <th style="text-align:center">nDCG@10‚Üë</th>
          <th style="text-align:center">P@10‚Üë</th>
          <th style="text-align:center">PII Leak‚Üì</th>
          <th style="text-align:center">Faithfulness‚Üë</th>
          <th style="text-align:center">Notes</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="text-align:center"><b>Vanilla RAG</b></td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">No filtering</td>
        </tr>
        <tr>
          <td style="text-align:center"><b>Pre‚Äëfiltered RAG (ours)</b></td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">Claim‚Äëlevel MoE; metadata re‚Äëweighting</td>
        </tr>
        <tr>
          <td style="text-align:center"><b>LLM‚Äëfiltered RAG</b></td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">Zero/few‚Äëshot filters</td>
        </tr>
      </tbody>
      <caption>Table B. Retrieval/QA metrics (no ROUGE‚ÄëL); populate with midterm numbers.</caption>
    </table>

    <p class="note"><b>Status (midterm):</b></p>
    <ul>
      <li>‚úÖ APIs + index + 3072‚Äëd embeddings in place; retrieval tool wired into LangGraph agent.</li>
      <li>‚úÖ XLSX/ENRON + Gmail IMAP ingest working.</li>
      <li>üü® Claimify (LLM CoT+ReAct) active as default classifiers; moving into main file.</li>
      <li>üü® RRF and filter‚Äëaware boosts to replace placeholder RNG.</li>
      <li>‚ö†Ô∏è Unify any 768‚Äëdim vestiges; keep Gemini helper gated/removed.</li>
    </ul>
    <hr />

    <h2 id="plan">Plan & Risks</h2>
    <ul>
      <li><b>Week 1‚Äì2:</b> Fine‚Äëtune relevance/tone/privacy heads; calibrate thresholds; stand up Pinecone + LangChain flow.</li>
      <li><b>Week 3:</b> Run Vanilla vs. Pre‚Äëfiltered vs. LLM‚Äëfiltered comparisons on held‚Äëout mixed ENRON set; report EM/F1, faithfulness, PII leak.</li>
      <li><b>Week 4:</b> Optional semantic RRF ablation; error analysis; finalize slides/report/site.</li>
    </ul>
    <p><b>Risks.</b> Email‚Äëlevel labels ‚Üí create synthetic claim‚Äëlevel supervision; class imbalance ‚Üí weighted sampling/focal loss; privacy eval ‚Üí synthetic PII injections; ambiguity ‚Üí keep with metadata; <b>engineering</b> ‚Üí unify index dimension (avoid 768 vs 3072 mismatch), replace placeholder RNG scoring with RRF, guard optional Gemini code paths.</p>
    <hr />

    <h2 id="conclusion">Conclusion & Future Work</h2>
    <p>We introduce ingestion‚Äëtime appropriateness filtering for corporate RAG: claim‚Äëlevel MoE classifiers decide what to store and how to weight retrieval. Next, we will broaden datasets (Avocado), expand filters (consistency checking against KB), and evaluate redaction policies vs. hard drops.</p>
    <hr />
  </div>
</body>
</html>
