<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Appropriateness Filtering for Corporate RAG Database Storage | CSCI 5541 (Fall 2025)</title>
  <link rel="stylesheet" href="./files/bulma.min.css" />
  <link rel="stylesheet" href="./files/styles.css" />
  <link rel="preconnect" href="https://fonts.gstatic.com/" />
  <link href="./files/css2" rel="stylesheet" />
  <link href="./files/css" rel="stylesheet" />
  <base href="." target="_blank" />
  <style>
    .wrapper{max-width:980px;margin:0 auto;padding:24px}
    .sys-img img{width:100%;height:auto}
    .authors-wrapper{display:flex;gap:18px;flex-wrap:wrap}
    .author-container{display:flex;flex-direction:column;align-items:center}
    .author-image img{width:96px;height:96px;border-radius:50%;object-fit:cover;background:#eee}
    .taglist{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 0}
    .kbd{background:#f5f5f5;border:1px solid #ddd;border-bottom-width:2px;border-radius:6px;padding:2px 6px;font-family:monospace}
    table{margin:0 auto}
    caption{caption-side:bottom;padding-top:8px}
    .note{font-size:.95rem;color:#444}
    .callout{background:#f7fbff;border:1px solid #cfe8ff;border-radius:10px;padding:12px}
  </style>
</head>
<body>
  <div class="wrapper">
    <h1 style="font-family:'Lato',sans-serif;">Appropriateness Filtering for Corporate RAG Database Storage</h1>
    <h4 style="font-family:'Lato',sans-serif;">Fall 2025 ¬∑ CSCI 5541 NLP ¬∑ University of Minnesota</h4>
    <h4 style="font-family:'Lato',sans-serif;">Team: NetWatch</h4>

    <div class="authors-wrapper">
      <div class="author-container">
        <div class="author-image"><img src="./files/Alex_B.png" alt="A. Berg" /></div>
        <p>A. Berg<br/><small><a href="mailto:ber00221@umn.edu">ber00221@umn.edu</a></small></p>
      </div>
      <div class="author-container">
        <div class="author-image"><img src="./files/Zeph_J.jpg" alt="Z. Johnson" /></div>
        <p>Z. Johnson<br/><small><a href="mailto:joh15514@umn.edu">joh15514@umn.edu</a></small></p>
      </div>
      <div class="author-container">
        <div class="author-image"><img src="./files/Alex_S.jpg" alt="A. Slinger" /></div>
        <p>A. Slinger<br/><small><a href="mailto:sling031@umn.edu">sling031@umn.edu</a></small></p>
      </div>
      <div class="author-container">
        <div class="author-image"><img src="./files/Sunder_S.png" alt="S. Subramanian" /></div>
        <p>S. Subramanian<br/><small><a href="mailto:subra287@umn.edu">subra287@umn.edu</a></small></p>
      </div>
    </div>

    <br />

    <div class="authors-wrapper">
      <div class="publication-links">
        <span class="link-block">
          <a href="" class="external-link button is-normal is-rounded is-dark is-outlined"><span>Final Report</span></a>
        </span>
        <span class="link-block">
          <a href="" class="external-link button is-normal is-rounded is-dark is-outlined"><span>Code</span></a>
        </span>
        <span class="link-block">
          <a href="" class="external-link button is-normal is-rounded is-dark is-outlined"><span>Model Weights</span></a>
        </span>
      </div>
    </div>
  </div>

  <div class="wrapper">
    <hr />

    <h2 id="abstract">Abstract</h2>
    <p>
      Retrieval‚ÄëAugmented Generation (RAG) quality depends on what gets embedded. Informal business channels (email/Slack) often mix valuable facts with personal, toxic, speculative, or sarcastic content. We propose a <b>pre‚Äëembedding filtering</b> framework that decomposes messages into claim‚Äëlevel units and scores each with a modular MoE of fine‚Äëtuned RoBERTa‚Äëlarge classifiers (relevance, tone/sarcasm, confidentiality/PII, toxicity, speculation/opinion, inconsistency). Below‚Äëthreshold claims are dropped; retained claims keep scores for downstream weighting. We will compare <i>pre‚Äëfiltered RAG</i> against <i>vanilla RAG</i> and <i>LLM‚Äëprompted filtering</i>, studying compounding effects of layered filters on QA quality and safety within an enterprise domain.
    </p>
    <hr />

    <h2 id="introduction">Introduction / Background / Motivation</h2>
    <p><b>Problem.</b> Enterprises rely on RAG over large internal corpora, but ~unstructured email/chat blends professional and personal content. Embedding inappropriate or unreliable text degrades retrieval and raises compliance risk.</p>
    <p><b>Gap.</b> Prior work emphasizes post‚Äëretrieval tricks (graph fusion, RRF); little evaluates <i>source‚Äëlevel</i> filtering before embedding when full context (headers/threads) is available.</p>
    <p><b>Hypothesis.</b> Appropriateness filtering at ingestion improves QA relevance and reduces PII/leak risk versus post‚Äëhoc ranking alone. Ambiguous claims (e.g., sarcasm intertwined with facts) are retained with metadata rather than blindly dropped.</p>
    <hr />

    <h2 id="approach">Approach</h2>
    <div class="callout">
      <ol>
        <li><b>Ingestion.</b> Gmail (IMAP via <code>imaplib</code>) demo + ENRON emails (from XLSX in Google Drive). Parse message text, headers, thread context.</li>
        <li><b>Claim decomposition.</b> Planned (scaffold only) ‚Äî atomic statement splitting prior to filtering.</li>
        <li><b>MoE filtering.</b> Planned ‚Äî fine‚Äëtuned RoBERTa‚Äëlarge heads (relevance, tone/sarcasm, confidentiality/PII, toxicity, speculation/opinion, inconsistency). Below‚Äëthreshold ‚Üí drop; else store with scores.</li>
        <li><b>Storage & retrieval.</b> <code>Pinecone</code> index <code>netwatch-claims</code>, embeddings via OpenAI <code>text-embedding-3-large</code> (<code>3072</code> dims). Retrieve via ANN; semantic RRF ranking logic stubbed.</li>
        <li><b>QA agent.</b> LangChain + LangGraph tool (<code>lookup_in_rag</code>) wired to an OpenAI chat model (<code>gpt-5-mini</code>). DSPy configured for prompt experiments.</li>
      </ol>
    </div>
    <p><b>Baselines.</b> (A) Vanilla RAG (no pre‚Äëfilter). (B) RAG + LLM re‚Äërank/filters (zero‚Äë/few‚Äëshot). (C) Optional: post‚Äëfilter RRF only.</p>
    <p><b>Novelty.</b> We evaluate ingestion‚Äëtime, claim‚Äëlevel filtering in an informal‚Äëcommunications domain where appropriate and non‚Äëappropriate content co‚Äëexist within messages, and run end‚Äëto‚Äëend ablations to quantify compounding effects.</p>

    <h3 id="impl">Implementation Snapshot (from current Colab)</h3>
    <ul>
      <li><b>APIs/Keys:</b> OpenAI + Pinecone pulled from Colab <code>userdata</code>.</li>
      <li><b>Embeddings:</b> <code>text-embedding-3-large</code> (3072‚Äëd).</li>
      <li><b>Index:</b> <code>netwatch-claims</code> (AWS us‚Äëeast‚Äë1, cosine).</li>
      <li><b>LLM:</b> <code>gpt-5-mini</code> via LangChain; DSPy LM set to <code>openai/gpt-5-mini</code>.</li>
      <li><b>Data I/O:</b> Google Drive mount; XLSX loader populates DataFrames for examples/ENRON/Gmail.</li>
      <li><b>Email ingest:</b> IMAP reads inbox, appends rows to <code>gmail_msgs_df</code>.</li>
      <li><b>Build DB:</b> <code>build_db()</code> currently indexes a test claim; pre‚Äëfilter hooks TODO.</li>
      <li><b>Retrieval:</b> <code>db_lookup()</code> + <code>lookup_in_rag</code> tool (placeholder scoring).</li>
      <li><b>UI:</b> Gradio <code>ChatInterface</code> with auth (<code>teamNetwatch</code>/<code>5541FinalProject</code>).</li>
    </ul>
    <hr />

    <h2 id="data">Data</h2>
    <p><b>Primary.</b> ~1,700 ENRON emails with tone/topic labels (email‚Äëlevel). For claim‚Äëlevel training/eval we construct a synthetic composite set by inserting professional facts/QA pairs (from MeetingBank‚ÄëQA‚ÄëSummary) into non‚Äëprofessional ENRON emails, yielding mixed‚Äëcontext messages with groundable QA.</p>
    <p><b>Claim extraction eval.</b> Benchmark against Claimify‚Äëstyle datasets to ensure accurate splitting independent of LLM prompting.</p>
    <hr />

    <h2 id="results">Preliminary Results & Evaluation</h2>
    <p><b>Two tracks.</b> (1) <i>Overall performance:</i> ablation from Vanilla ‚Üí +Relevance ‚Üí +Tone/Sarcasm ‚Üí +Privacy/PII ‚Üí ‚Ä¶ measuring QA EM/F1, faithfulness, refusal on sensitive prompts, and PII‚Äëleak rate. (2) <i>Module performance:</i> classifier accuracy vs. GPT‚Äë4/5 zero‚Äë and few‚Äëshot prompts; optional prompt‚Äëoptimization with DSPy.</p>
    <table>
      <thead>
        <tr>
          <th style="text-align:center"><strong>Setting</strong></th>
          <th style="text-align:center">QA EM / F1</th>
          <th style="text-align:center">Faithfulness‚Üë</th>
          <th style="text-align:center">PII Leak‚Üì</th>
          <th style="text-align:center">Notes</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="text-align:center"><strong>Vanilla RAG</strong></td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">No filtering</td>
        </tr>
        <tr>
          <td style="text-align:center"><strong>Pre‚Äëfiltered RAG (ours)</strong></td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">Claim‚Äëlevel MoE</td>
        </tr>
        <tr>
          <td style="text-align:center"><strong>LLM‚Äëfiltered RAG</strong></td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">TBD</td>
          <td style="text-align:center">Zero/few‚Äëshot prompts</td>
        </tr>
      </tbody>
      <caption>Table 1. Evaluation plan; populate with midterm preliminary numbers.</caption>
    </table>
    <div style="text-align:center;margin:18px 0 32px">
      <img style="height:300px" alt="Placeholder results figure" src="./files/results.png" />
    </div>
    <p class="note"><b>Status (midterm):</b></p>
    <ul>
      <li>‚úÖ API setup (OpenAI, Pinecone), index creation, and 3072‚Äëd embedding flow working.</li>
      <li>‚úÖ Google Drive XLSX import populates <code>example_claims_df</code>, <code>enron_*_df</code>, and <code>gmail_*_df</code>.</li>
      <li>‚úÖ Gmail IMAP ingestion functioning; rows appended to <code>gmail_msgs_df</code>.</li>
      <li>‚úÖ LangGraph chatbot + retrieval tool wired; Gradio demo online (local auth).</li>
      <li>üü® Claim splitter scaffolded (not yet enforcing atomicity in pipeline).</li>
      <li>üü® MoE classifier heads planned; thresholds/metadata schema drafted.</li>
      <li>üü® Retrieval scoring uses placeholder RNG; will replace with semantic RRF + filter‚Äëaware boosts.</li>
      <li>‚ö†Ô∏è Engineering note: a legacy helper defines a 768‚Äëdim Pinecone path; unify on 3072 to match <code>text-embedding-3-large</code>.</li>
      <li>‚ö†Ô∏è Engineering note: Gemini scratch helper is inactive; keep gated or remove.</li>
    </ul>
    <hr />

    <h2 id="plan">Plan & Risks</h2>
    <ul>
      <li><b>Week 1‚Äì2:</b> Fine‚Äëtune relevance/tone/privacy heads; calibrate thresholds; stand up Pinecone + LangChain flow.</li>
      <li><b>Week 3:</b> Run Vanilla vs. Pre‚Äëfiltered vs. LLM‚Äëfiltered comparisons on held‚Äëout mixed ENRON set; report EM/F1, faithfulness, PII leak.</li>
      <li><b>Week 4:</b> Optional semantic RRF ablation; error analysis; finalize slides/report/site.</li>
    </ul>
    <p><b>Risks.</b> Email‚Äëlevel labels ‚Üí create synthetic claim‚Äëlevel supervision; class imbalance ‚Üí weighted sampling/focal loss; privacy eval ‚Üí synthetic PII injections; ambiguity ‚Üí keep with metadata; <b>engineering</b> ‚Üí unify index dimension (avoid 768 vs 3072 mismatch), replace placeholder RNG scoring with RRF, guard optional Gemini code paths.</p>
    <hr />

    <h2 id="conclusion">Conclusion & Future Work</h2>
    <p>We introduce ingestion‚Äëtime appropriateness filtering for corporate RAG: claim‚Äëlevel MoE classifiers decide what to store and how to weight retrieval. Next, we will broaden datasets (Avocado), expand filters (consistency checking against KB), and evaluate redaction policies vs. hard drops.</p>
    <hr />
  </div>
</body>
</html>
